---
title: "Triad Networks"
author: "Tim Vigers"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
library(bnlearn)
library(rjags)
library(MCMCvis)
library(patchwork)
library(tidyverse)
```

```{r data import,echo=FALSE}
# Load list and data
load("/Users/timvigers/GitHub/MS-Thesis/data/networks/pair_list.Rdata")
load("/Users/timvigers/GitHub/MS-Thesis/data/networks/pair_data.Rdata")
pair_data$T1Dgroup = factor(pair_data$T1Dgroup)
```

```{r model structures,echo=FALSE}
# Define all network structures
# Empty graph
net = empty.graph(c("T1Dgroup","methyl","metab"))
# Structures
# 3 arcs
struct1 = "[T1Dgroup][methyl|T1Dgroup:metab][metab|T1Dgroup]"
struct2 = "[T1Dgroup][methyl|T1Dgroup][metab|T1Dgroup:methyl]"
struct3 = "[T1Dgroup|methyl:metab][methyl][metab|methyl]"
struct4 = "[T1Dgroup|methyl][methyl][metab|methyl:T1Dgroup]"
struct5 = "[T1Dgroup|metab:methyl][methyl|metab][metab]"
struct6 = "[T1Dgroup|metab][methyl|metab:T1Dgroup][metab]"
# 2 arcs
struct7 = "[T1Dgroup][methyl|T1Dgroup][metab|T1Dgroup]"
struct8 = "[T1Dgroup|methyl][methyl][metab|T1Dgroup]"
struct9 = "[T1Dgroup|metab][methyl|T1Dgroup][metab]"
struct10 = "[T1Dgroup|metab:methyl][methyl][metab]"
struct11 = "[T1Dgroup|methyl][methyl][metab|methyl]"
struct12 = "[T1Dgroup][methyl|T1Dgroup][metab|methyl]"
struct13 = "[T1Dgroup|methyl][methyl|metab][metab]"
struct14 = "[T1Dgroup][methyl|metab:T1Dgroup][metab]"
struct15 = "[T1Dgroup|metab][methyl|metab][metab]"
struct16 = "[T1Dgroup][methyl|metab][metab|T1Dgroup]"
struct17 = "[T1Dgroup|metab][methyl][metab|methyl]"
struct18 = "[T1Dgroup][methyl][metab|methyl:T1Dgroup]"
# 1 arc
struct19 = "[T1Dgroup][methyl|T1Dgroup][metab]"
struct20 = "[T1Dgroup][methyl][metab|T1Dgroup]"
struct21 = "[T1Dgroup|methyl][methyl][metab]"
struct22 = "[T1Dgroup][methyl][metab|methyl]"
struct23 = "[T1Dgroup|metab][methyl][metab]"
struct24 = "[T1Dgroup][methyl|metab][metab]"
```

```{r mcmc test,echo=FALSE}
methyl = "cg00287636"
metab = "gctof_33"
y = as.numeric(pair_data$T1Dgroup) - 1
X = pair_data[,methyl]
X = matrix(X[complete.cases(X)])
N = nrow(X)
# JAGS
jags_data = list(y=y,X=X,N=N)
mod = jags.model("/Users/timvigers/GitHub/MS-Thesis/code/networks/logistic.jags",
                 data = jags_data, n.adapt = 1000,n.chains = 2)
# MCMC
samples = coda.samples(mod,variable.names = c("beta0","beta1"),n.iter = 10000)
# Output
output = MCMCsummary(samples, 
                     params = c("beta0","beta1","beta2"),
                     Rhat = F,
                     n.eff = F,
                     HPD = T,
                     hpd_prob = 0.8,
                     digits = 3)

glm(T1Dgroup ~ gctof_33,data = pair_data,family = "binomial")
```

