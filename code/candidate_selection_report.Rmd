---
title: "Triad Selection"
author: "Tim Vigers"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(arsenal)
library(skimr)
library(knitr)
library(tidyverse)
```

## Step 1: Metabolite - Methylation

For this step I ran linear models (adjusted and unadjusted) with methylation as the outcome and metabolites as the predictor. Adjusted models also included age and sex as covariates. In order to narrow down the number of models, I only looked at the metabolites that have come up repeatedly in Liz's analyses. 

### GC-TOF Candidates

```{r echo=FALSE}
candidates <- read.csv("/Users/timvigers/Documents/GitHub/MS-Thesis/data/metabolomics/liz_candidates.csv",stringsAsFactors = F)
gctof_candidates <- unique(candidates$gctof)
gctof_candidates <- gctof_candidates[order(as.numeric(sub(".*_","",gctof_candidates)))]
kable(gctof_candidates,row.names = F,col.names = "")
```

### Adjusted Model

```{r eval=FALSE}
lm(cg00000029 ~ sex + age + gctof_89, data = data)
```

#### Plots

```{r gctof adj import,echo=FALSE,cache=TRUE}
gctof <- read.csv("/Users/timvigers/Documents/GitHub/MS-Thesis/candidate_selection/step_1/sv/gctof_SV_adj.csv")
gctof <- gctof %>% arrange(p.value,Value)
hist(gctof$Value,xlab = expression(paste(beta," Value")), 
     main = expression(paste("Histogram of ",beta," Values")))
hist(gctof$p.value,xlab = "P Value", main = "Histogram of P Values")
volcano <- ggplot(gctof,aes(x = Value, y = -log(p.value,base = 10))) + 
  geom_point() + theme_bw() + ylab("-log10 p-value") + xlab("Estimate")
volcano
```

#### Number of Candidates by Cutoff

```{r echo=FALSE}
gctof$p.adj <- p.adjust(gctof$p.value, method = "fdr")
num_cand <- gctof %>% summarise(`FDR < 0.05` = sum(p.adj < 0.05),
                            `< 1e-3` = sum(p.value < 1e-3),
                            `< 1e-4` = sum(p.value < 1e-4),
                            `< 1e-5` = sum(p.value < 1e-5),
                            `< 1e-6` = sum(p.value < 1e-6),
                            `< 1e-7` = sum(p.value < 1e-7),
                            `< 1e-8` = sum(p.value < 1e-8))
kable(num_cand)
```

#### Top 10 (Sorted by P Value Then Estimate) 

```{r echo=FALSE}
gctof$p.value <- format(gctof$p.value,digits = 3)
gctof$p.adj <- format(gctof$p.adj,digits = 3)
kable(head(gctof,n=10),row.names = F)
```

### Undjusted Model

```{r eval=FALSE}
lm(cg00000029 ~ gctof_89, data = data)
```

#### Plots

```{r gctof unadj import,echo=FALSE,cache=TRUE}
gctof <- read.csv("/Users/timvigers/Documents/GitHub/MS-Thesis/candidate_selection/step_1/sv/gctof_SV_unadj.csv")
gctof <- gctof %>% arrange(p.value,Value)
hist(gctof$Value,xlab = expression(paste(beta," Value")), 
     main = expression(paste("Histogram of ",beta," Values")))
hist(gctof$p.value,xlab = "P Value", main = "Histogram of P Values")
volcano <- ggplot(gctof,aes(x = Value, y = -log(p.value,base = 10))) + 
  geom_point() + theme_bw() + ylab("-log10 p-value") + xlab("Estimate")
volcano
```

#### Number of Candidates by Cutoff

```{r echo=FALSE}
gctof$p.adj <- p.adjust(gctof$p.value, method = "fdr")
num_cand <- gctof %>% summarise(`FDR < 0.05` = sum(p.adj < 0.05),
                            `< 1e-3` = sum(p.value < 1e-3),
                            `< 1e-4` = sum(p.value < 1e-4),
                            `< 1e-5` = sum(p.value < 1e-5),
                            `< 1e-6` = sum(p.value < 1e-6),
                            `< 1e-7` = sum(p.value < 1e-7),
                            `< 1e-8` = sum(p.value < 1e-8))
kable(num_cand)
```

#### Top 10 (Sorted by P Value Then Estimate) 

```{r echo=FALSE}
gctof$p.value <- format(gctof$p.value,digits = 3)
gctof$p.adj <- format(gctof$p.adj,digits = 3)
kable(head(gctof,n=10),row.names = F)
```