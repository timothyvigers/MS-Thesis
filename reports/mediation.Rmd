---
title: "MS Thesis Mediation"
author: "Tim Vigers"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,warning = FALSE)
knitr::opts_knit$set(root.dir = "C:/Users/Tim Vigers/Documents/GitHub/MS-Thesis")
library(mediation)
library(parallel)
library(flextable)
library(diagram)
library(tidyverse)
set.seed(1017)
```

```{r}
load("./data/mediation/mediation_quasi.Rdata")
load("./data/networks/pair_list.Rdata")
load("./data/networks/all_data.Rdata")
mediation_quasi = as.data.frame(mediation_quasi)
mediation_quasi[,3:ncol(mediation_quasi)] = 
  lapply(mediation_quasi[,3:ncol(mediation_quasi)],as.numeric)
# Plot
data <- c(0, "'a'", 0,
          0, 0, 0, 
          "'b'", "'c'", 0)
M<- matrix (nrow=3, ncol=3, byrow = TRUE, data=data)
plot<- plotmat (M, pos=c(1,2), 
                name= c( "M","X", "T1D Status"), 
                box.type = "rect", box.size = 0.12, box.prop=0.5,  
                curve=0)
```

Total effect = c + ab, or the effect of X on Y without controlling for M.

c = the direct effect of X on Y after controlling for M 

Amount of mediation = ab = total effect - c

# Volcano plots of ACME

```{r}
methyl_med = mediation_quasi[grep("cg.*",mediation_quasi[,"M"]),]
metab_med = mediation_quasi[grep("cg.*",mediation_quasi[,"X"]),]
```

## Methylation as "M"

The following p values are not adjusted for multiple comparisons.

```{r}
ggplot(methyl_med,aes(x = `Average ACME`, y = -log10(`Average ACME p`))) +
  geom_point() + theme_bw()
```

## Metabolite as "M"

```{r}
ggplot(metab_med,aes(x = `Average ACME`, y = -log10(`Average ACME p`))) +
  geom_point() + theme_bw()
```

## Everything

```{r}
ggplot(mediation_quasi,aes(x = `Average ACME`, y = -log10(`Average ACME p`))) +
  geom_point() + theme_bw()
```

# P value histograms

## Total Effect

```{r}
hist(mediation_quasi$`Total Effect p`)
```

## Average ACME

```{r}
hist(mediation_quasi$`Average ACME p`)
```

## Average ADE

```{r}
hist(mediation_quasi$`Average ADE p`)
```

## Average Proportion Mediated

```{r}
hist(methyl_med$`Average Prop. Med. p`)
```

